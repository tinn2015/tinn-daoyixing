<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>选择城市</title>
</head>
<style>
    body,ul,li,p,h3{margin:0;padding:0;}
    ul,li{list-style: none;}
    .page{width:960px;margin:0 auto;border:1px solid green;}
    .content{overflow: hidden;}
    .zhixia_box{overflow:hidden;margin-top:40px;line-height: 30px;}
    .city{width:200px;text-align: center;float:left;height:30px;line-height: 30px;color:#0064d2;position:relative;}
    h3{float:left;}
    p{clear:both;}
    .page .area{float:left;height:30px;line-height:30px;padding:0 15px;color:#2bb8bc;}
    .area_box{clear:both;display:none;overflow: hidden;width:700px;padding:10px 20px;border:1px solid #0064d2;margin:0 auto;border-radius: 10px;background:#EEEEEE;}
    .city_box{overflow: hidden;width:800px;margin:20px auto;}
    .province{font-weight:bold;}
    hr{width:800px;margin:20px auto;}
    .city img{position:absolute;bottom:-1px;right:91px;display:none;}
</style>
<body>
    <div class="page">
        <div class="zhixia_box">
            <img src="arrow.png" alt=""/>
        </div>
        <hr/>
        <div class="content">
            <img src="arrow.png" alt=""/>
        </div>

    </div>
</body>
</html>
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
    $(function() {
        var _regionData = null;
        $.ajaxSettings.async = false;
        $.getJSON("js/cityData.min.json", function (data) {
            _regionData = data;
        });

        region();
        function region() {
            var city_html = "";
            var area_html = "";
            var area_html_zhixai = "";
            var _cityData = null;
            var _areaData = null;
            var zhixia_html = "";
            var m = 0;
            var undefindCity = '';
            var undefindArea = '';
                $(_regionData).each(function (i) {
                    if (i == 0) {
                        zhixia_html += '<h3>直辖市</h3>'
                    }
                    _cityData = _regionData[i].s;
                    $(_cityData).each(function (j) {
                        //插入省份
                        if(j==0 && _cityData[j].n !== _regionData[i].n){
                            city_html += '<p class="province" provinceId="'+_regionData[i].v+'">'+_regionData[i].n+'</p><div class="city_box">';
                        }
                        //区分直辖市与普通城市
                        if (_cityData[j].n === _regionData[i].n) {
                            m++;
                            zhixia_html += '<div class="city zhixia"  cityId="' + _cityData[j].v + '">' + _cityData[j].n + '<div><img src="arrow.png" alt=""/></div></div>';
                            //当前直辖市的区
                            _areaData = _cityData[j].s;
                            area_html_zhixai += '<ul class="area_box" id="'+_cityData[j].v+'" cityname="'+ _cityData[j].n +'">';
                            $(_areaData).each(function(k){
                                area_html_zhixai += '<li class="area" areaId="'+_areaData[k].v+'">'+_areaData[k].n+'</li>';
                            });
                            area_html_zhixai += '</ul>';
                            if(m==4){
                                zhixia_html += area_html_zhixai;
                            }
                        }else{
                            city_html += '<div class="city"  cityId="' + _cityData[j].v + '">'+_cityData[j].n+'<div><img src="arrow.png" alt=""/></div></div>';
                            if (_cityData[j].v == undefined) {
                                undefindCity += _cityData[j].n + ';';
                            }
                            //当前市 的区
                            _areaData = _cityData[j].s;
                            area_html += '<ul class="area_box" id="'+_cityData[j].v+'" cityname="'+ _cityData[j].n +'">';
                            $(_areaData).each(function(k){
                                area_html += '<li class="area" areaId="'+_areaData[k].v+'">'+_areaData[k].n+'</li>';
                                if ( undefined == _areaData[k].v) {
                                    undefindArea +=  _areaData[k].n + ';';
                                }
                            });
                            area_html += '</ul>';
                            if (( j>0 && j%4==3) || (j==(getJsonObjLength(_regionData[i].s))-1)){
                                city_html += area_html;
                                area_html = '';
                            }
                        }
                    });
                    city_html += '</div>'
                });
            console.log(undefindCity);
            console.log(undefindArea);
            $(".zhixia_box").html(zhixia_html);
            $(".content").html(city_html);
            cityTap()
        }

        function getJsonObjLength(jsonObj) {
            var Length = 0;
            for (var item in jsonObj) {
                Length++;
            }
            return Length;
        }
        function cityTap() {
            $(".page").find(".city").click(function(e){
                e.stopPropagation();
                $(this).find("img").toggle();
                $(".area_box").stop(true,true);
                cityId = $(this).attr("cityId");
                $('#'+cityId+'').slideToggle(500);
                $(".area_box").not('#'+cityId+'').hide();
                $(".city").not(this).find("img").hide();
            });
            $("body").not(".city").click(function(){
                $(".area_box").stop(false,false);
                $(".area_box").hide();
                $(".city").not(this).find("img").hide();
            })
        }
    })

</script>